# ðŸ§ª PWA Test Guide - Mode Offline/Online

**Version:** beta-3.3.0
**Date:** 2025-10-27
**Agent:** Claude Code

---

## âœ… Build Validation (Automated)

**Status:** âœ… PASSED

```bash
npm run build
# âœ… dist/sw.js (2.7KB)
# âœ… dist/manifest.webmanifest (689B)
# âœ… Build time: 1.18s
```

---

## ðŸ§ª Manual Testing (Browser Required)

### Prerequisites
- Chrome/Edge/Firefox (latest)
- Dev server running: `npm run dev` or deployed app

---

## Test 1: Service Worker Registration

**Steps:**
1. Open app in browser
2. Open DevTools (F12) â†’ Application tab â†’ Service Workers
3. Verify:
   - âœ… Service Worker registered
   - âœ… Status: "activated and is running"
   - âœ… Source: `/sw.js`

**Expected:**
```
Service Worker: emergence-shell-v1
Status: activated
Scope: /
```

---

## Test 2: Cache Shell Assets

**Steps:**
1. DevTools â†’ Application â†’ Cache Storage
2. Expand `emergence-shell-v1`
3. Verify cached files (17 files):
   - âœ… `/index.html`
   - âœ… `/src/frontend/main.js`
   - âœ… `/src/frontend/core/app.js`
   - âœ… `/src/frontend/styles/main-styles.css`
   - âœ… `/assets/emergence_logo_icon.png`
   - ... (12 more files)

**Expected:**
17 files cached in `emergence-shell-v1`

---

## Test 3: Offline Mode - Conversations Snapshot

**Steps:**
1. **Online:** Login + navigate to Chat
2. Create 3-5 conversations with messages
3. DevTools â†’ Application â†’ IndexedDB â†’ `emergence-offline`
4. Verify stores:
   - âœ… `snapshots` store exists
   - âœ… Contains conversations (max 30)
5. **Go Offline:** DevTools â†’ Network tab â†’ Throttling â†’ "Offline"
6. Reload page (Ctrl+R)
7. Verify:
   - âœ… App loads (from cache)
   - âœ… Conversations visible in sidebar
   - âœ… Messages displayed
   - âœ… Offline indicator visible (top-right)

**Expected:**
- Conversations accessible offline
- Indicator: "ðŸ”´ Mode hors ligne"

---

## Test 4: Offline Mode - Message Outbox

**Steps:**
1. **Offline mode** (from Test 3)
2. Open a conversation
3. Type a message: "Test offline message"
4. Send message
5. DevTools â†’ IndexedDB â†’ `emergence-offline` â†’ `outbox` store
6. Verify:
   - âœ… Message in outbox queue
   - âœ… Timestamp recorded

**Expected:**
Message stored in outbox (not sent yet)

---

## Test 5: Online Sync - Outbox Flush

**Steps:**
1. **Offline mode with message in outbox** (from Test 4)
2. DevTools â†’ Network â†’ Throttling â†’ "Online"
3. Wait 1 second (750ms flush delay)
4. Verify:
   - âœ… Toast notification: "Connexion rÃ©tablie"
   - âœ… Message sent to backend (Network tab â†’ POST /api/chat/message)
   - âœ… Outbox store empty (DevTools â†’ IndexedDB)
   - âœ… Offline indicator hidden

**Expected:**
- Message synced automatically
- Outbox flushed in <1s

---

## Test 6: PWA Installability

**Steps:**
1. Chrome â†’ Address bar â†’ Install icon (âŠ•)
2. Click "Install EMERGENCE V8"
3. Verify:
   - âœ… Standalone window opens
   - âœ… No browser UI (address bar hidden)
   - âœ… App icon in desktop/Start menu

**Alternative (Mobile):**
- Safari iOS: Share â†’ Add to Home Screen
- Chrome Android: Menu â†’ Install app

**Expected:**
App installable as native-like PWA

---

## ðŸŽ¯ Acceptance Criteria

| Test | Status | Notes |
|------|--------|-------|
| Service Worker registered | â³ To test | DevTools check |
| 17 files cached | â³ To test | Cache Storage |
| Conversations snapshot offline | â³ To test | IndexedDB snapshots |
| Message outbox offline | â³ To test | IndexedDB outbox |
| Auto-sync online (750ms) | â³ To test | Network flush |
| PWA installable | â³ To test | Install prompt |

---

## ðŸ“ Known Limitations

1. **Max 30 snapshots** - Oldest conversations not cached
2. **200 messages/thread** - Long threads truncated offline
3. **Outbox messages** - Sent after 750ms delay (not instant)
4. **Cache shell only** - Dynamic API responses not cached (network-first)

---

## ðŸ› Troubleshooting

**Service Worker not registering:**
- Check HTTPS or localhost (required)
- Clear cache: DevTools â†’ Application â†’ Clear storage
- Check console errors

**Offline mode not working:**
- Verify IndexedDB enabled (not incognito mode)
- Check Service Worker activated
- Verify Network throttling set correctly

**Sync not flushing:**
- Check Network tab for API calls
- Verify online event fired (console)
- Check outbox store manually (should be empty after sync)

---

## âœ… Next Steps

1. **Manual testing** - Follow tests 1-6 above
2. **Production testing** - Test on deployed Cloud Run app
3. **Mobile testing** - Test iOS Safari + Chrome Android
4. **E2E automation** - Playwright tests for PWA (future)

---

**Generated by:** Claude Code
**Date:** 2025-10-27
**Contact:** gonzalefernando@gmail.com
