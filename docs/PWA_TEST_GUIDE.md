# 🧪 PWA Test Guide - Mode Offline/Online

**Version:** beta-3.3.0
**Date:** 2025-10-27
**Agent:** Claude Code

---

## ✅ Build Validation (Automated)

**Status:** ✅ PASSED

```bash
npm run build
# ✅ dist/sw.js (2.7KB)
# ✅ dist/manifest.webmanifest (689B)
# ✅ Build time: 1.18s
```

---

## 🧪 Manual Testing (Browser Required)

### Prerequisites
- Chrome/Edge/Firefox (latest)
- Dev server running: `npm run dev` or deployed app

---

## Test 1: Service Worker Registration

**Steps:**
1. Open app in browser
2. Open DevTools (F12) → Application tab → Service Workers
3. Verify:
   - ✅ Service Worker registered
   - ✅ Status: "activated and is running"
   - ✅ Source: `/sw.js`

**Expected:**
```
Service Worker: emergence-shell-v1
Status: activated
Scope: /
```

---

## Test 2: Cache Shell Assets

**Steps:**
1. DevTools → Application → Cache Storage
2. Expand `emergence-shell-v1`
3. Verify cached files (17 files):
   - ✅ `/index.html`
   - ✅ `/src/frontend/main.js`
   - ✅ `/src/frontend/core/app.js`
   - ✅ `/src/frontend/styles/main-styles.css`
   - ✅ `/assets/emergence_logo_icon.png`
   - ... (12 more files)

**Expected:**
17 files cached in `emergence-shell-v1`

---

## Test 3: Offline Mode - Conversations Snapshot

**Steps:**
1. **Online:** Login + navigate to Chat
2. Create 3-5 conversations with messages
3. DevTools → Application → IndexedDB → `emergence-offline`
4. Verify stores:
   - ✅ `snapshots` store exists
   - ✅ Contains conversations (max 30)
5. **Go Offline:** DevTools → Network tab → Throttling → "Offline"
6. Reload page (Ctrl+R)
7. Verify:
   - ✅ App loads (from cache)
   - ✅ Conversations visible in sidebar
   - ✅ Messages displayed
   - ✅ Offline indicator visible (top-right)

**Expected:**
- Conversations accessible offline
- Indicator: "🔴 Mode hors ligne"

---

## Test 4: Offline Mode - Message Outbox

**Steps:**
1. **Offline mode** (from Test 3)
2. Open a conversation
3. Type a message: "Test offline message"
4. Send message
5. DevTools → IndexedDB → `emergence-offline` → `outbox` store
6. Verify:
   - ✅ Message in outbox queue
   - ✅ Timestamp recorded

**Expected:**
Message stored in outbox (not sent yet)

---

## Test 5: Online Sync - Outbox Flush

**Steps:**
1. **Offline mode with message in outbox** (from Test 4)
2. DevTools → Network → Throttling → "Online"
3. Wait 1 second (750ms flush delay)
4. Verify:
   - ✅ Toast notification: "Connexion rétablie"
   - ✅ Message sent to backend (Network tab → POST /api/chat/message)
   - ✅ Outbox store empty (DevTools → IndexedDB)
   - ✅ Offline indicator hidden

**Expected:**
- Message synced automatically
- Outbox flushed in <1s

---

## Test 6: PWA Installability

**Steps:**
1. Chrome → Address bar → Install icon (⊕)
2. Click "Install EMERGENCE V8"
3. Verify:
   - ✅ Standalone window opens
   - ✅ No browser UI (address bar hidden)
   - ✅ App icon in desktop/Start menu

**Alternative (Mobile):**
- Safari iOS: Share → Add to Home Screen
- Chrome Android: Menu → Install app

**Expected:**
App installable as native-like PWA

---

## 🎯 Acceptance Criteria

| Test | Status | Notes |
|------|--------|-------|
| Service Worker registered | ⏳ To test | DevTools check |
| 17 files cached | ⏳ To test | Cache Storage |
| Conversations snapshot offline | ⏳ To test | IndexedDB snapshots |
| Message outbox offline | ⏳ To test | IndexedDB outbox |
| Auto-sync online (750ms) | ⏳ To test | Network flush |
| PWA installable | ⏳ To test | Install prompt |

---

## 📝 Known Limitations

1. **Max 30 snapshots** - Oldest conversations not cached
2. **200 messages/thread** - Long threads truncated offline
3. **Outbox messages** - Sent after 750ms delay (not instant)
4. **Cache shell only** - Dynamic API responses not cached (network-first)

---

## 🐛 Troubleshooting

**Service Worker not registering:**
- Check HTTPS or localhost (required)
- Clear cache: DevTools → Application → Clear storage
- Check console errors

**Offline mode not working:**
- Verify IndexedDB enabled (not incognito mode)
- Check Service Worker activated
- Verify Network throttling set correctly

**Sync not flushing:**
- Check Network tab for API calls
- Verify online event fired (console)
- Check outbox store manually (should be empty after sync)

---

## ✅ Next Steps

1. **Manual testing** - Follow tests 1-6 above
2. **Production testing** - Test on deployed Cloud Run app
3. **Mobile testing** - Test iOS Safari + Chrome Android
4. **E2E automation** - Playwright tests for PWA (future)

---

**Generated by:** Claude Code
**Date:** 2025-10-27
**Contact:** gonzalefernando@gmail.com
