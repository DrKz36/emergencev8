/* src/frontend/features/chat/chat.css */
/* V11.3 — Bandeau RAG + chips sources */

:root{
  --glass-bg: rgba(22,22,26,55);
  --glass-blur: 18px;
  --glass-border-color: rgba(255,255,255,10);
  --glass-shadow: 0 10px 30px rgba(0,0,0,35);
  --radius-xl: 18px;

  --color-text-primary:#e9e9ef;

  --chat-bubble-width: 900px;
  --bubbleW: min(var(--chat-bubble-width), 90%);

  --color-anima:#e11d48; /* Rouge "OFF" */
  --color-neo:#2563eb;
  --color-nexus:#10b981; /* Vert "ON"  */
  --user-hex: #6a0dad;
  --bubble-tint: 80%;

  --rag-off: var(--color-anima);
  --rag-on:  var(--color-nexus);
}

.chat-container{
  background:var(--glass-bg);
  -webkit-backdrop-filter:blur(var(--glass-blur)); backdrop-filter:blur(var(--glass-blur));
  border:1px solid var(--glass-border-color);
  border-radius:var(--radius-xl);
  box-shadow: var(--glass-shadow);
  display:flex; flex-direction:column; height:100%;
}

.chat-header{
  display:flex; align-items:center; justify-content:space-between; gap:.75rem;
  padding:.875rem 1.25rem;
  border-bottom:1px solid var(--glass-border-color);
  background:linear-gradient(180deg, rgba(255,255,255,04), rgba(255,255,255,02));
}

/* ===== Bandeau RAG ===== */
.rag-banner{
  display:flex; flex-direction:column; gap:.5rem;
  padding:.6rem 1.0rem .7rem;
  border-bottom:1px solid var(--glass-border-color);
  background:linear-gradient(180deg, rgba(16,185,129,0.12), rgba(16,185,129,0.06));
}
.rag-banner.searching{ background:linear-gradient(180deg, rgba(37,99,235,0.12), rgba(37,99,235,0.06)); }
.rag-row{ display:flex; align-items:center; gap:.5rem; color:#fff; opacity:.95; font-weight:600; font-size:.95rem; }
.rag-dot{
  width:9px; height:9px; border-radius:50%;
  background:var(--rag-on);
  position:relative;
}
.rag-dot[data-state="searching"]::after{
  content:''; position:absolute; inset:-6px; border-radius:50%;
  border:2px solid rgba(255,255,255,.35); animation: rag-pulse 1s infinite;
}
@keyframes rag-pulse{ from{ transform:scale(.85); opacity:.6 } to{ transform:scale(1.25); opacity:0 } }

.rag-sources{ display:flex; gap:.4rem; flex-wrap:wrap; margin-top:.2rem; }
.rag-chip{
  appearance:none; border:none; cursor:pointer;
  padding:.25rem .55rem; border-radius:999px;
  background:rgba(255,255,255,.12); color:#fff; font-weight:600; font-size:.8rem;
  border:1px solid rgba(255,255,255,.25);
}
.rag-chip:hover{ background:rgba(255,255,255,.18); }

/* Messages */
.chat-messages{
  display:flex; flex-direction:column; gap:14px;
  padding:1rem 1.25rem;
  max-height:calc(100vh - 260px);
  overflow-y:auto;
  max-width:50%;
  width:100%;
  margin:0 auto;
}

.message{ display:flex; flex-direction:column; gap:.25rem; }
.message.user{ align-items:flex-start; }
.message.assistant{ align-items:flex-start; }

.message-meta{ display:flex; gap:.5rem; font-size:.75rem; font-weight:600; color:#fff; opacity:.9; line-height:1; margin-bottom:.45rem; }
.sender-name { font-family: 'Comic Sans MS', cursive, sans-serif; }
.message-time { font-size: 0.7rem; opacity: 0.75; }

.chat-container .message-content{
  width:100%;
  max-width: var(--bubbleW);
  background:transparent!important; border:none!important; box-shadow:none!important;
  display:flex; flex-direction:column; gap:.5rem;
}

.chat-container .message-text{
  line-height:1.6; color:var(--color-text-primary);
  padding:.85rem 1rem; border-radius:14px; border:none; text-align:left;
  width:100% !important;
  -webkit-backdrop-filter:blur(6px) saturate(120%); backdrop-filter:blur(6px) saturate(120%);
  background: color-mix(in srgb, #8b5cff var(--bubble-tint), transparent);
}

/* Couleurs par rôle/agent */
.chat-container .message.assistant.anima .message-text{
  background: color-mix(in srgb, #ff496a var(--bubble-tint), transparent);
  color:#fff;
}
.chat-container .message.assistant.neo .message-text{
  background: color-mix(in srgb, #30a4ff var(--bubble-tint), transparent);
  color:#fff;
}
.chat-container .message.assistant.nexus .message-text{
  background: color-mix(in srgb, #8b5cff var(--bubble-tint), transparent);
  color:#fff;
}
.chat-container .message.user .message-text{
  background: color-mix(in srgb, var(--user-hex) var(--bubble-tint), transparent);
  color:#fff;
}

/* Input + actions (inchangé) */
.chat-input-area{ padding:.9rem 1.25rem 1.25rem; border-top:1px solid var(--glass-border-color);
  background:linear-gradient(0deg, rgba(255,255,255,04), rgba(255,255,255,02)); }
.chat-form{ display:grid; grid-template-columns:1fr auto; gap:.5rem; align-items:center; }
.chat-input{
  width:100%; max-height:160px; resize:none;
  background:rgba(255,255,255,06);
  border:1px solid var(--glass-border-color);
  border-radius:12px; padding:.75rem .9rem; color:#fff; line-height:1.5;
  transition:border-color .2s ease, background .2s ease;
}
.chat-input:focus{ border-color:var(--user-hex); background:rgba(255,255,255,08); outline:none; }
.chat-send-button{ width:36px; height:36px; display:inline-flex; align-items:center; justify-content:center; }

/* Bouton RAG (ON/OFF) */
.chat-actions{ display:flex; gap:.75rem; flex-wrap:wrap; align-items:center; }
.chat-container .rag-label{ color:#fff; opacity:.9; font-size:.95rem; display:inline-flex; align-items:center; height:27px; }
.chat-container .rag-power{
  display:inline-flex; align-items:center; justify-content:center;
  width:27px; height:27px; border-radius:50%;
  background: rgba(255,255,255,08);
  border:1px solid rgba(255,255,255,25);
  cursor:pointer;
  transition: transform .15s ease, box-shadow .2s ease, background .2s ease;
}
.chat-container .rag-power:hover{ transform: translateY(-1px); background: rgba(255,255,255,12); }
.chat-container .rag-power .icon-power{ width:18px; height:18px; }
.chat-container .rag-power .power-line,
.chat-container .rag-power .power-circle{
  fill:none; stroke: var(--rag-off); stroke-width:2.25; stroke-linecap:round; stroke-linejoin:round;
  transition: stroke .2s ease, filter .2s ease;
}
.chat-container .rag-power[aria-checked="true"] .power-line,
.chat-container .rag-power[aria-checked="true"] .power-circle{
  stroke: var(--rag-on);
  filter: drop-shadow(0 0 6px rgba(16,185,129,65));
}

/* Responsive */
@media (max-width: 768px){
  .chat-messages{ max-width:100%; }
}
@media (max-width: 430px){
  .chat-send-button{ width:44px; height:44px; border:1px solid rgba(255,255,255,4); border-radius:10px; }
  .chat-actions .button{ padding:.6rem .8rem; }
}
