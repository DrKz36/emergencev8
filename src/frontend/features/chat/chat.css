/* src/frontend/features/chat/chat.css — V11.7 (Memory banner + keep V11.6) */

/* ====== (contenu existant V11.6) ====== */
:root{
  --glass-bg: rgba(22,22,26,.55);
  --glass-blur: 18px;
  --glass-border-color: rgba(255,255,255,.10);
  --glass-shadow: 0 10px 30px rgba(0,0,0,.35);
  --radius-xl: 18px;

  --color-text-primary:#e9e9ef;

  --chat-bubble-width: 900px;
  --bubbleW: min(var(--chat-bubble-width), 90%);

  --color-anima:#e11d48;
  --color-neo:#2563eb;
  --color-nexus:#10b981;
  --anima-hex:#ff496a;
  --neo-hex:#30a4ff;
  --nexus-hex:#8b5cff;
  --user-hex: #6a0dad;

  --rag-on:#16a34a;   /* vert ON */
  --rag-off:#dc2626;  /* rouge OFF */

  --scroll-thumb: rgba(180,180,190,.85);
  --scroll-track: rgba(255,255,255,.08);
}

/* === Conteneur chat === */
.chat-container{
  background:var(--glass-bg);
  -webkit-backdrop-filter:blur(18px); backdrop-filter:blur(18px);
  border:1px solid var(--glass-border-color);
  border-radius:var(--radius-xl);
  box-shadow: var(--glass-shadow);
  display:flex; flex-direction:column; height:100%;
  min-height:0;
  overflow: visible !important;   /* ne pas clipper le footer sticky */
}

.chat-header{
  display:flex; align-items:center; justify-content:space-between; gap:.75rem;
  padding:.875rem 1.25rem;
  border-bottom:1px solid var(--glass-border-color);
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
}

.chat-messages{
  flex:1; min-height:0;
  overflow:auto; padding:1rem;
  display:flex; flex-direction:column; gap:.75rem; align-items:center;
}

.message{ width:var(--bubbleW); display:flex; flex-direction:column; gap:.4rem; }
.message .message-content{ display:flex; flex-direction:column; gap:.25rem; }
.message .message-text{
  border:none; border-radius:14px; padding:.8rem .9rem; color:#fff;
  -webkit-backdrop-filter:blur(6px) saturate(120%); backdrop-filter:blur(6px) saturate(120%);
  box-shadow:0 8px 24px rgba(0,0,0,.25), 0 0 22px rgba(255,255,255,.07);
}
.message.user .message-text{
  background:linear-gradient(180deg, rgba(106,13,173,.80) 0%, rgba(106,13,173,.60) 100%);
  box-shadow:0 14px 34px rgba(106,13,173,.35), 0 0 0 1px rgba(255,255,255,.06) inset;
}
.message.assistant.anima .message-text{
  background:linear-gradient(180deg, rgba(225,29,72,.80) 0%, rgba(225,29,72,.60) 100%);
  box-shadow:0 14px 34px rgba(255,73,106,.40), 0 0 0 1px rgba(255,255,255,.06) inset;
}
.message.assistant.neo .message-text{
  background:linear-gradient(180deg, rgba(37,99,235,.80) 0%, rgba(37,99,235,.60) 100%);
  box-shadow:0 14px 34px rgba(48,164,255,.40), 0 0 0 1px rgba(255,255,255,.06) inset;
}
.message.assistant.nexus .message-text{
  background:linear-gradient(180deg, rgba(16,185,129,.80) 0%, rgba(16,185,129,.60) 100%);
  box-shadow:0 14px 34px rgba(16,185,129,.40), 0 0 0 1px rgba(255,255,255,.06) inset;
}

.message .message-meta.meta-inside{ display:flex; align-items:center; gap:.5rem; opacity:.9; font-size:.9rem; }
.sender-name{ font-weight:700 }
.message-time{ opacity:.9 }

/* ===== Zone saisie ===== */
.chat-input-area{
  position: sticky;
  bottom: calc(env(safe-area-inset-bottom) + 12px);
  z-index: 1;
  background: linear-gradient(180deg, rgba(255,255,255,.028), rgba(255,255,255,.016));
  -webkit-backdrop-filter: blur(10px) saturate(115%); backdrop-filter: blur(10px) saturate(115%);
  border: 1px solid rgba(255,255,255,.10);
  border-radius: 14px;
  padding: .6rem .8rem .8rem;
  margin: .6rem .6rem 0;
  box-shadow: 0 8px 26px rgba(0,0,0,.25);
}

.chat-form{ display:grid; grid-template-columns: 1fr; gap:.6rem; align-items:center; }

/* Textarea */
.chat-input{
  width:100%;
  min-height: clamp(56px, 9.5vh, 104px);
  max-height: 18vh;
  resize:none; overflow:auto;
  background:rgba(255,255,255,.06);
  border:1px solid var(--glass-border-color);
  border-radius:12px; padding:.85rem 1rem; color:#fff;
  line-height:1.45; transition:border-color .2s ease, background .2s ease;
}
.chat-input:focus{ border-color:var(--user-hex); background:rgba(255,255,255,.08); outline:none; }

/* Scrollbar (textarea) */
.chat-input::-webkit-scrollbar{ width: 10px; }
.chat-input::-webkit-scrollbar-track{ background: var(--scroll-track); border-radius: 10px; }
.chat-input::-webkit-scrollbar-thumb{ background: var(--scroll-thumb); border-radius: 10px; }
.chat-input{ scrollbar-color: var(--scroll-thumb) transparent; scrollbar-width: thin; }

/* Séparateur + actions */
.chat-actions{
  position: relative;
  display:flex; align-items:center; gap:.6rem;
  margin-top:.55rem; padding-top:.55rem;
  border-top: 1px solid rgba(255,255,255,.10);
  flex-wrap: wrap;
  z-index: 2; /* > à tout overlay éventuel */
}

/* ===================== RAG (power) — styles ===================== */
.chat-actions .rag-control #rag-power{
  display:inline-flex !important;
  align-items:center !important; justify-content:center !important;
  width:34px !important; height:34px !important;
  border-radius:999px !important; cursor:pointer !important;
  border:1px solid rgba(255,255,255,.22) !important; color:#fff !important;
  -webkit-backdrop-filter: blur(6px) saturate(120%) !important;
  backdrop-filter: blur(6px) saturate(120%) !important;
  background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04)) !important;
  transition: filter .15s ease, box-shadow .15s ease, background .15s ease, transform .06s ease !important;
  box-shadow: 0 8px 18px rgba(0,0,0,.25) !important;
}
.chat-actions .rag-control #rag-power:active{ transform: translateY(1px) !important; }
.chat-actions .rag-control #rag-power > svg{
  width:16px; height:16px; display:block; pointer-events:none;
  stroke: currentColor; fill: none;
}
.chat-actions .rag-control #rag-power[aria-checked="false"]{
  background-color: var(--rag-off) !important;
  border-color: var(--rag-off) !important;
  box-shadow: 0 0 14px rgba(220,38,38,.40), inset 0 0 10px rgba(255,255,255,.22), inset 0 -8px 12px rgba(0,0,0,.25) !important;
}
.chat-actions .rag-control #rag-power[aria-checked="true"]{
  background-color: var(--rag-on) !important;
  border-color: var(--rag-on) !important;
  box-shadow: 0 0 14px rgba(22,163,74,.40), inset 0 0 10px rgba(255,255,255,.22), inset 0 -8px 12px rgba(0,0,0,.22) !important;
}
.chat-actions .rag-control #rag-power:hover{ filter:brightness(1.06) !important; }

.rag-control{ display:inline-flex; align-items:center; gap:.5rem; height:34px; }
.rag-label{ font-weight:700; letter-spacing:.02em; color:var(--color-text-primary); }

/* ================== Exporter / Effacer — verre ================= */
.chat-actions #chat-export,
.chat-actions #chat-clear{
  display:inline-flex !important; align-items:center !important; justify-content:center !important;
  height:34px !important; padding:0 .8rem !important;
  border-radius:12px !important; color:#fff !important; cursor:pointer !important;
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04)) !important;
  border:1px solid rgba(255,255,255,.18) !important;
  -webkit-backdrop-filter: blur(6px) saturate(120%) !important;
  backdrop-filter: blur(6px) saturate(120%) !important;
  box-shadow: 0 6px 18px rgba(0,0,0,.25) !important;
}
.chat-actions #chat-export:hover,
.chat-actions #chat-clear:hover{ background:rgba(255,255,255,.12) !important; }
.chat-actions #chat-clear:active{ background:#b91c1c !important; border-color:#b91c1c !important; }

/* ===================== SEND (flèche) — FIX ===================== */
.chat-actions .chat-send-button,
.chat-actions button#chat-send,
.chat-actions button.send,
.chat-actions button[type="submit"]{
  order: 999;
  margin-left: auto !important;
  display:inline-flex !important; align-items:center !important; justify-content:center !important;
  width:36px !important; height:36px !important;
  border-radius:999px !important; color:#fff !important; cursor:pointer !important;
  background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06)) !important;
  border:1px solid rgba(255,255,255,.22) !important;
  -webkit-backdrop-filter: blur(8px) saturate(125%) !important;
  backdrop-filter: blur(8px) saturate(125%) !important;
  box-shadow: 0 8px 20px rgba(0,0,0,.28) !important;
  position: relative; z-index: 3;
  padding: 0 !important;
  line-height: 1 !important;
}
.chat-actions .chat-send-button:hover,
.chat-actions button#chat-send:hover,
.chat-actions button.send:hover,
.chat-actions button[type="submit"]{
  filter: brightness(1.06);
}
.chat-actions .chat-send-button:active,
.chat-actions button#chat-send:active,
.chat-actions button.send:active,
.chat-actions button[type="submit"]:active{
  transform: translateY(1px);
}

.chat-actions .chat-send-button > *,
.chat-actions button#chat-send > *,
.chat-actions button.send > *,
.chat-actions button[type="submit"] > *{
  pointer-events: none;
}
.chat-actions .chat-send-button svg,
.chat-actions button#chat-send svg,
.chat-actions button.send svg,
.chat-actions button[type="submit"] svg{
  width:18px; height:18px; display:block; stroke: currentColor; fill: none;
}

/* ===== Responsif ===== */
@media (max-width: 1024px){
  .chat-input{ min-height: clamp(64px, 10vh, 108px); }
}
@media (max-width: 760px){
  .chat-messages{ align-items: stretch; }
  .message{ width: 100%; }
  .chat-input{ min-height: clamp(52px, 8.8vh, 92px); }
}

/* ===================== MÉMOIRE — BANNIÈRE ===================== */
.memory-banner{
  display:inline-flex; align-items:center; gap:.4rem;
  padding:.35rem .5rem; border-radius:10px;
  background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
  border:1px solid rgba(255,255,255,.14);
  -webkit-backdrop-filter: blur(6px) saturate(120%); backdrop-filter: blur(6px) saturate(120%);
  color:#fff; font-size:.82rem; box-shadow:0 6px 16px rgba(0,0,0,.22);
}
.memory-banner .pill{
  display:inline-flex; align-items:center; gap:.35rem;
  height:22px; padding:0 .55rem; border-radius:999px; font-weight:700; letter-spacing:.02em;
  border:1px solid rgba(255,255,255,.18);
  background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.05));
}
.memory-banner .pill .dot{
  width:8px; height:8px; border-radius:999px; display:inline-block; background:#9ca3af;
}
.memory-banner .pill.ok .dot{ background:#16a34a; }     /* vert  */
.memory-banner .pill.ko .dot{ background:#dc2626; }     /* rouge */
.memory-banner .sep{
  width:1px; height:18px; background:rgba(255,255,255,.15); margin:0 .2rem;
}

/* Placement à droite du header */
.chat-header .memory-banner{ margin-left:auto; }
