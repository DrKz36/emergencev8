/* src/frontend/features/chat/chat.css */
/* V10.2 — largeur FIXE identique agent/user via .message-content,
   .message-text à 100%, styles boutons/RAG inchangés, fonds 80% conservés. */

:root{
  --glass-bg: rgba(22,22,26,.55);
  --glass-blur: 18px;
  --glass-border-color: rgba(255,255,255,.10);
  --glass-shadow: 0 10px 30px rgba(0,0,0,.35);
  --radius-xl: 18px;

  --color-text-primary:#e9e9ef;

  /* largeur commune des bulles */
  --chat-bubble-width: 900px;                                   /* desktop */
  --bubbleW: min(var(--chat-bubble-width), 90%);                /* clamp */
}

/* Container global */
.chat-container{
  background:var(--glass-bg);
  -webkit-backdrop-filter:blur(var(--glass-blur)); backdrop-filter:blur(var(--glass-blur));
  border:1px solid var(--glass-border-color);
  border-radius:var(--radius-xl);
  box-shadow: var(--glass-shadow);
  display:flex; flex-direction:column; height:100%;
}

/* Header */
.chat-header{
  display:flex; align-items:center; justify-content:space-between; gap:.75rem;
  padding:.875rem 1.25rem;
  border-bottom:1px solid var(--glass-border-color);
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
}

.chat-messages{ display:flex; flex-direction:column; gap:14px; padding:1rem 1.25rem; max-height:calc(100vh - 260px); overflow-y:auto; }

/* Messages */
.message{ display:flex; flex-direction:column; gap:.25rem; }
.message.user{ align-items:flex-end; }     /* utilisateur à droite */
.message.assistant{ align-items:flex-start; }

/* Méta (dans la bulle) */
.message-meta{ display:flex; gap:.5rem; font-size:.75rem; font-weight:600; letter-spacing:.01em; color:#fff; opacity:.9; line-height:1; margin-bottom:.45rem; }
.message.user .message-meta{ justify-content:flex-end; }
.message.assistant .message-meta{ justify-content:flex-start; }
.message-content .message-meta.meta-inside{ margin:0 0 .45rem 0; }
.message.assistant .message-content .message-meta.meta-inside{ padding-left:1rem; }
.message.user .message-content .message-meta.meta-inside{ padding-right:1rem; }

/* >>> Wrapper de bulle — largeur FIXE commune, côté agent ET user <<< */
.message-content{
  background:transparent!important; border:none!important; box-shadow:none!important;
  width:var(--bubbleW); max-width:var(--bubbleW); min-width:var(--bubbleW);
  display:flex; flex-direction:column; gap:.5rem;
}

/* Texte de bulle — prend 100% du wrapper ci‑dessus */
.message-text{
  line-height:1.6; color:var(--color-text-primary);
  padding:.85rem 1rem; border-radius:14px; border:none; text-align:left;
  width:100% !important; max-width:100% !important; min-width:100% !important;
  position:relative;
  -webkit-backdrop-filter:blur(6px) saturate(120%); backdrop-filter:blur(6px) saturate(120%);
  box-shadow:0 8px 24px rgba(0,0,0,.25), 0 0 22px rgba(255,255,255,.07);
}

/* Couleurs (fonds 80%) + halos — AGENTS & USER */
:root{
  --color-anima:#e11d48; --color-neo:#2563eb; --color-nexus:#10b981;
  --anima-hex:#ff496a; --neo-hex:#30a4ff; --nexus-hex:#8b5cff;
  --user-hex: var(--color-primary, #0a84ff);
  --bubble-tint: 80%; --halo-opacity:.40;
}

.message.assistant.anima .message-text{
  background:linear-gradient(180deg, rgba(255,73,106,.80) 0%, rgba(255,73,106,.60) 100%);
  background: color-mix(in srgb, var(--anima-hex) var(--bubble-tint), transparent);
  color:#fff;
  box-shadow:0 14px 34px rgba(255,73,106,var(--halo-opacity)), 0 0 0 1px rgba(255,255,255,.06) inset;
}
.message.assistant.neo .message-text{
  background:linear-gradient(180deg, rgba(48,164,255,.80) 0%, rgba(48,164,255,.60) 100%);
  background: color-mix(in srgb, var(--neo-hex) var(--bubble-tint), transparent);
  color:#fff;
  box-shadow:0 14px 34px rgba(48,164,255,var(--halo-opacity)), 0 0 0 1px rgba(255,255,255,.06) inset;
}
.message.assistant.nexus .message-text{
  background:linear-gradient(180deg, rgba(139,92,255,.80) 0%, rgba(139,92,255,.60) 100%);
  background: color-mix(in srgb, var(--nexus-hex) var(--bubble-tint), transparent);
  color:#fff;
  box-shadow:0 14px 34px rgba(139,92,255,var(--halo-opacity)), 0 0 0 1px rgba(255,255,255,.06) inset;
}

/* Utilisateur (fond 80%) */
.message.user .message-text{
  background:linear-gradient(180deg, rgba(10,132,255,.80) 0%, rgba(10,132,255,.60) 100%);
  background: color-mix(in srgb, var(--user-hex) var(--bubble-tint), transparent);
  color:#fff;
  box-shadow:0 12px 28px rgba(10,132,255,.35), 0 0 0 1px rgba(255,255,255,.06) inset;
}

/* Zone input + actions */
.chat-input-area{
  padding:.9rem 1.25rem 1.25rem;
  border-top:1px solid var(--glass-border-color);
  background:linear-gradient(0deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
}
.chat-form{ display:grid; grid-template-columns:1fr auto; gap:.5rem; }
.chat-input{
  width:100%; max-height:160px; resize:none;
  background:rgba(255,255,255,.06);
  border:1px solid var(--glass-border-color);
  border-radius:12px; padding:.75rem .9rem; color:#fff;
  transition:border-color .2s ease, background .2s ease;
}
.chat-input:focus{ border-color:var(--user-hex); background:rgba(255,255,255,.08); outline:none; }

/* Actions (RAG + Exporter + Effacer) */
.chat-actions{
  display:flex; align-items:center; gap:.75rem;
  margin-top:.75rem; padding-bottom:.25rem;
}
.chat-actions .toggle.toggle-metal{
  display:inline-flex; align-items:center; height:34px;
  padding:.25rem .6rem; border-radius:999px; border:1px solid rgba(255,255,255,.22);
  background:radial-gradient(130% 130% at 25% 15%, rgba(255,255,255,.9) 0%, rgba(255,255,255,.35) 35%, rgba(255,255,255,0) 60%), linear-gradient(145deg, #2e2e2e, #4a4a4a);
  color:#e9e9e9;
}
.chat-actions .button,
.chat-actions button{
  height:34px; display:inline-flex; align-items:center; justify-content:center;
  padding:.42rem .8rem; font-weight:600; font-size:.9rem;
  background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
  border:1px solid rgba(255,255,255,.22); border-radius:10px;
  color:#e9e9e9;
  box-shadow:0 6px 18px rgba(0,0,0,.24), 0 0 14px rgba(255,255,255,.06) inset;
  transition:all .18s ease-out;
}
.chat-actions .button:hover{ filter:brightness(1.05); transform:translateY(-1px); }
.chat-actions .button:active{ transform:translateY(0); }

.chat-send-button{
  width:36px; height:36px; display:inline-flex; align-items:center; justify-content:center;
  background:
    radial-gradient(130% 130% at 25% 15%, rgba(255,255,255,.9) 0%, rgba(255,255,255,.35) 35%, rgba(255,255,255,0) 60%),
    linear-gradient(145deg, #b3b3b3, #e6e6e6);
  color:#111; border:1px solid rgba(255,255,255,.3); border-radius:10px;
  box-shadow: inset 0 0 8px rgba(255,255,255,.55), inset 0 -10px 18px rgba(0,0,0,.18), 0 6px 18px rgba(0,0,0,.25);
  transition:filter .25s ease, transform .12s ease, box-shadow .25s ease;
}
.chat-send-button:hover{
  filter:brightness(1.05);
  background:radial-gradient(120% 120% at 30% 20%, rgba(255,255,255,1) 0%, rgba(255,255,255,.4) 35%, rgba(255,255,255,0) 60%), linear-gradient(145deg, #c8c8c8, #f3f3f3);
  box-shadow:inset 0 0 10px rgba(255,255,255,.65), inset 0 -12px 20px rgba(0,0,0,.2), 0 8px 22px rgba(0,0,0,.32);
  transform:translateY(-1px);
}
.chat-send-button:active{ transform:translateY(0); }

/* Streaming cursor */
.blinking-cursor{ display:inline-block; animation: blink 1s steps(2, start) infinite; }
@keyframes blink { to { visibility:hidden; } }

/* Responsive */
@media (max-width: 768px){
  :root{ --chat-bubble-width: 620px; --bubbleW: min(var(--chat-bubble-width), 94%); }
}
@media (max-width: 560px){
  :root{ --chat-bubble-width: 520px; --bubbleW: min(var(--chat-bubble-width), 98%); }
}

/* === FIX V10.3 — Alignement du texte des messages utilisateur à DROITE === */
.chat-messages .message.user .message-text{
  text-align: right;
}
