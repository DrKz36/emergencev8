/* src/frontend/features/chat/chat.css — V11.2
   - Empêche la coupe du bloc saisie (overflow visible)
   - Bloc sticky avec marge basse via safe-area (bottom: calc(...))
   - Pas de marge externe basse ⇒ limite le scroll de page
   - Encadré arrondi + séparateur + glow POWER conservés
   - Autosize + scrollbar grise conservés
*/
:root{
  --glass-bg: rgba(22,22,26,.55);
  --glass-blur: 18px;
  --glass-border-color: rgba(255,255,255,.10);
  --glass-shadow: 0 10px 30px rgba(0,0,0,.35);
  --radius-xl: 18px;

  --color-text-primary:#e9e9ef;

  --chat-bubble-width: 900px;
  --bubbleW: min(var(--chat-bubble-width), 90%);

  --color-anima:#e11d48;
  --color-neo:#2563eb;
  --color-nexus:#10b981;
  --anima-hex:#ff496a;
  --neo-hex:#30a4ff;
  --nexus-hex:#8b5cff;
  --user-hex: #6a0dad;

  --scroll-thumb: rgba(180,180,190,.85);
  --scroll-track: rgba(255,255,255,.08);
}

/* === Conteneur chat (ne PAS clipper le sticky) === */
.chat-container{
  background:var(--glass-bg);
  -webkit-backdrop-filter:blur(18px); backdrop-filter:blur(18px);
  border:1px solid var(--glass-border-color);
  border-radius:var(--radius-xl);
  box-shadow: var(--glass-shadow);
  display:flex; flex-direction:column; height:100%;
  min-height:0;
  overflow: visible !important;   /* <— clé: pas de clipping du footer sticky */
}

.chat-header{
  display:flex; align-items:center; justify-content:space-between; gap:.75rem;
  padding:.875rem 1.25rem;
  border-bottom:1px solid var(--glass-border-color);
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
}

.chat-messages{
  flex:1; min-height:0;
  overflow:auto; padding:1rem;
  display:flex; flex-direction:column; gap:.75rem; align-items:center;
}

.message{ width:var(--bubbleW); display:flex; flex-direction:column; gap:.4rem; }
.message .message-content{ display:flex; flex-direction:column; gap:.25rem; }
.message .message-text{
  border:none; border-radius:14px; padding:.9rem 1rem; color:#fff;
  -webkit-backdrop-filter:blur(6px) saturate(120%); backdrop-filter:blur(6px) saturate(120%);
  box-shadow:0 8px 24px rgba(0,0,0,.25), 0 0 22px rgba(255,255,255,.07);
}
.message.user .message-text{
  background:linear-gradient(180deg, rgba(106,13,173,.80) 0%, rgba(106,13,173,.60) 100%);
  box-shadow:0 14px 34px rgba(106,13,173,.35), 0 0 0 1px rgba(255,255,255,.06) inset;
}
.message.assistant.anima .message-text{
  background:linear-gradient(180deg, rgba(225,29,72,.80) 0%, rgba(225,29,72,.60) 100%);
  box-shadow:0 14px 34px rgba(255,73,106,.40), 0 0 0 1px rgba(255,255,255,.06) inset;
}
.message.assistant.neo .message-text{
  background:linear-gradient(180deg, rgba(37,99,235,.80) 0%, rgba(37,99,235,.60) 100%);
  box-shadow:0 14px 34px rgba(48,164,255,.40), 0 0 0 1px rgba(255,255,255,.06) inset;
}
.message.assistant.nexus .message-text{
  background:linear-gradient(180deg, rgba(16,185,129,.80) 0%, rgba(16,185,129,.60) 100%);
  box-shadow:0 14px 34px rgba(16,185,129,.40), 0 0 0 1px rgba(255,255,255,.06) inset;
}

.message .message-meta.meta-inside{ display:flex; align-items:center; gap:.5rem; opacity:.85; font-size:.85rem; }
.sender-name{ font-weight:700 }
.message-time{ opacity:.8 }

/* ============ Zone saisie: encadré arrondi, sticky, jamais coupé ============ */
.chat-input-area{
  position: sticky;
  bottom: calc(env(safe-area-inset-bottom) + 12px); /* <— garde une marge sans créer de scroll page */
  z-index: 1;
  background: linear-gradient(180deg, rgba(255,255,255,.028), rgba(255,255,255,.016));
  -webkit-backdrop-filter: blur(10px) saturate(115%); backdrop-filter: blur(10px) saturate(115%);
  border: 1px solid rgba(255,255,255,.10);
  border-radius: 14px;
  padding: 1rem 1rem 1.4rem;       /* respiration interne */
  margin: .6rem .6rem 0;           /* <— pas de marge basse externe */
  box-shadow: 0 8px 26px rgba(0,0,0,.25);
}

.chat-form{
  display:grid; grid-template-columns: 1fr; gap:.6rem; align-items:center; /* <- 1 seule colonne (textarea) */
}

/* Textarea: plus haute, adaptative, autosize via JS */
.chat-input{
  width:100%;
  min-height: clamp(84px, 12vh, 140px);
  max-height: 40vh;
  resize:none; overflow:auto;
  background:rgba(255,255,255,.06);
  border:1px solid var(--glass-border-color);
  border-radius:12px; padding:.9rem 1rem; color:#fff;
  line-height:1.5; transition:border-color .2s ease, background .2s ease;
}
.chat-input:focus{ border-color:var(--user-hex); background:rgba(255,255,255,.08); outline:none; }

/* Scrollbar grise (textarea) */
.chat-input::-webkit-scrollbar{ width: 10px; }
.chat-input::-webkit-scrollbar-track{ background: var(--scroll-track); border-radius: 10px; }
.chat-input::-webkit-scrollbar-thumb{ background: var(--scroll-thumb); border-radius: 10px; }
.chat-input{ scrollbar-color: var(--scroll-thumb) transparent; scrollbar-width: thin; }

/* Séparateur + actions */
.chat-actions{
  display:flex; align-items:center; gap:.6rem;
  margin-top:.8rem; padding-top:.8rem;
  border-top: 1px solid rgba(255,255,255,.10);
  flex-wrap: wrap;
}

/* RAG: POWER seul coloré + glow */
.rag-control{ display:inline-flex; align-items:center; gap:.5rem; height:32px; }
#rag-power{
  display:inline-flex; align-items:center; justify-content:center;
  width:32px; height:32px; border-radius:999px;
  border:1px solid rgba(255,255,255,.22); color:#fff;
  -webkit-backdrop-filter: blur(6px) saturate(120%); backdrop-filter: blur(6px) saturate(120%);
  background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04));
  transition: filter .15s ease, box-shadow .15s ease, background .15s ease;
}
#rag-power[aria-checked="false"]{
  background-color:#dc2626;
  box-shadow: 0 0 14px rgba(220,38,38,.35), inset 0 0 10px rgba(255,255,255,.20), inset 0 -8px 12px rgba(0,0,0,.25);
  border-color:#dc2626;
}
#rag-power[aria-checked="true"]{
  background-color:#16a34a;
  box-shadow: 0 0 14px rgba(22,163,74,.35), inset 0 0 10px rgba(255,255,255,.22), inset 0 -8px 12px rgba(0,0,0,.22);
  border-color:#16a34a;
}
#rag-power:hover{ filter:brightness(1.06); }
.rag-label{ font-weight:700; letter-spacing:.02em; color:var(--color-text-primary); }

/* Exporter / Effacer compacts */
#chat-export, #chat-clear{
  display:inline-flex; align-items:center; justify-content:center;
  height:32px; padding:0 .75rem;
  border-radius:12px; color:#fff; background:transparent;
  border:1px solid rgba(255,255,255,.18);
}
#chat-export:hover, #chat-clear:hover{ background:rgba(255,255,255,.06); }
#chat-clear:active{ background:#b91c1c; border-color:#b91c1c; }

/* Nouvel emplacement de l’avion : dans .chat-actions, +15% */
.chat-actions .chat-send-button{
  width: 37px; height: 37px;      /* ~ +15% vs 32px */
  margin-left: auto;              /* pousse l’avion à droite de la rangée */
  display:inline-flex; align-items:center; justify-content:center;
}

/* Responsif: un peu plus de hauteur initiale sur petits écrans */
@media (max-width: 1024px){
  .chat-input{ min-height: clamp(84px, 14vh, 136px); }
}
@media (max-width: 760px){
  .chat-input{ min-height: clamp(84px, 16vh, 132px); }
}
