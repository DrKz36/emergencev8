/* src/frontend/features/chat/chat.css */
/* V11 — scope strict au chat, pas d'override global. Pas de largeur figée
   hors conteneur, toggle stylé uniquement dans .chat-container. */

:root{
  --glass-bg: rgba(22,22,26,.55);
  --glass-blur: 18px;
  --glass-border-color: rgba(255,255,255,.10);
  --glass-shadow: 0 10px 30px rgba(0,0,0,.35);
  --radius-xl: 18px;

  --color-text-primary:#e9e9ef;

  --chat-bubble-width: 900px;
  --bubbleW: min(var(--chat-bubble-width), 90%);

  --color-anima:#e11d48;
  --color-neo:#2563eb;
  --color-nexus:#10b981;
  --user-hex: #6a0dad; /* violet foncé */
  --bubble-tint: 80%;
}

.chat-container{
  background:var(--glass-bg);
  -webkit-backdrop-filter:blur(var(--glass-blur)); backdrop-filter:blur(var(--glass-blur));
  border:1px solid var(--glass-border-color);
  border-radius:var(--radius-xl);
  box-shadow: var(--glass-shadow);
  display:flex; flex-direction:column; height:100%;
}

.chat-header{
  display:flex; align-items:center; justify-content:space-between; gap:.75rem;
  padding:.875rem 1.25rem;
  border-bottom:1px solid var(--glass-border-color);
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
}

/* Messages */
.chat-messages{ display:flex; flex-direction:column; gap:14px; padding:1rem 1.25rem; max-height:calc(100vh - 260px); overflow-y:auto; }
.message{ display:flex; flex-direction:column; gap:.25rem; }
.message.user{ align-items:flex-start; }
.message.assistant{ align-items:flex-start; }

.message-meta{ display:flex; gap:.5rem; font-size:.75rem; font-weight:600; color:#fff; opacity:.9; line-height:1; margin-bottom:.45rem; }
.sender-name { font-family: 'Comic Sans MS', cursive, sans-serif; }
.message-time { font-size: 0.7rem; opacity: 0.75; }

/* >>> largeur NON figée en dehors du conteneur chat <<< */
.chat-container .message-content{
  width:100%;
  max-width: var(--bubbleW);
  background:transparent!important; border:none!important; box-shadow:none!important;
  display:flex; flex-direction:column; gap:.5rem;
}

.chat-container .message-text{
  line-height:1.6; color:var(--color-text-primary);
  padding:.85rem 1rem; border-radius:14px; border:none; text-align:left;
  width:100% !important;
  -webkit-backdrop-filter:blur(6px) saturate(120%); backdrop-filter:blur(6px) saturate(120%);
  box-shadow:0 8px 24px rgba(0,0,0,.25), 0 0 22px rgba(255,255,255,.07);
}

/* Halo + couleurs par rôle/agent (scopé) */
.chat-container .message.assistant.anima .message-text{
  background: color-mix(in srgb, #ff496a var(--bubble-tint), transparent);
  color:#fff;
}
.chat-container .message.assistant.neo .message-text{
  background: color-mix(in srgb, #30a4ff var(--bubble-tint), transparent);
  color:#fff;
}
.chat-container .message.assistant.nexus .message-text{
  background: color-mix(in srgb, #8b5cff var(--bubble-tint), transparent);
  color:#fff;
}
.chat-container .message.user .message-text{
  background: color-mix(in srgb, var(--user-hex) var(--bubble-tint), transparent);
  color:#fff;
}

/* Input */
.chat-input-area{
  padding:.9rem 1.25rem 1.25rem;
  border-top:1px solid var(--glass-border-color);
  background:linear-gradient(0deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
}
.chat-form{ display:grid; grid-template-columns:1fr auto; gap:.5rem; align-items:center; }
.chat-input{
  width:100%; max-height:160px; resize:none;
  background:rgba(255,255,255,.06);
  border:1px solid var(--glass-border-color);
  border-radius:12px; padding:.75rem .9rem; color:#fff; line-height:1.5;
  transition:border-color .2s ease, background .2s ease;
}
.chat-input:focus{ border-color:var(--user-hex); background:rgba(255,255,255,.08); outline:none; }
.chat-send-button{ width:36px; height:36px; display:inline-flex; align-items:center; justify-content:center; }

/* Actions header : wrap en mobile */
.chat-actions{ display:flex; gap:.5rem; flex-wrap:wrap; align-items:center; }

/* ============================= */
/* Toggle “métal” — SCOPÉ au chat */
/* ============================= */
.chat-container .toggle.toggle-metal{ display:inline-flex; align-items:center; gap:.5rem; }
.chat-container .toggle.toggle-metal .toggle-track{
  position:relative; width:56px; height:28px; border-radius:999px;
  background:rgba(255,255,255,.16);
  border:1px solid rgba(255,255,255,.35);
  transition:background .2s ease, border-color .2s ease;
}
.chat-container .toggle.toggle-metal .toggle-thumb{
  position:absolute; top:2px; left:2px; width:24px; height:24px; border-radius:50%;
  background:#fff; box-shadow:0 2px 6px rgba(0,0,0,.45);
  transition:left .2s ease;
}
.chat-container .toggle.toggle-metal[aria-checked="true"] .toggle-thumb{ left:calc(100% - 26px); }
.chat-container .toggle.toggle-metal[aria-checked="true"] .toggle-track{
  background: color-mix(in srgb, var(--user-hex) 45%, rgba(255,255,255,.16));
  border-color: rgba(255,255,255,.5);
}
.chat-container .toggle-label{ font-size:.85rem; opacity:.9; }

@media (max-width: 430px){
  .chat-send-button{ width:44px; height:44px; border:1px solid rgba(255,255,255,.4); border-radius:10px; }
  .chat-actions .button{ padding:.6rem .8rem; }
  .chat-container .toggle.toggle-metal .toggle-track{ width:64px; height:32px; }
  .chat-container .toggle.toggle-metal .toggle-thumb{ width:28px; height:28px; }
  .chat-container .toggle.toggle-metal[aria-checked="true"] .toggle-thumb{ left:calc(100% - 30px); }
}
