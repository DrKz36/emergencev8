<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>&Eacute;MERGENCE V8</title>

  <!-- Favicon/Logo -->
  <link rel="icon" type="image/png" href="/assets/emergence_logo.png" />
  <link rel="apple-touch-icon" href="/assets/emergence_logo.png" />


  <!-- Import map pour React et ReactDOM -->
  <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.3.1",
        "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
        "papaparse": "https://esm.sh/papaparse@5.4.1",
        "jspdf": "https://esm.sh/jspdf@2.5.2",
        "jspdf-autotable": "https://esm.sh/jspdf-autotable@3.8.3"
      }
    }
  </script>

  <!-- Preload module JS -->
  <link rel="modulepreload" href="/src/frontend/main.js" />

  <!-- ===== CSS CORE ===== -->
  <link rel="stylesheet" href="/src/frontend/styles/core/reset.css">
  <link rel="stylesheet" href="/src/frontend/styles/core/_variables.css">
  <link rel="stylesheet" href="/src/frontend/styles/themes/light.css">
  <link rel="stylesheet" href="/src/frontend/styles/themes/dark.css">
  <link rel="stylesheet" href="/src/frontend/styles/core/_typography.css">
  <link rel="stylesheet" href="/src/frontend/styles/core/_layout.css">
  <link rel="stylesheet" href="/src/frontend/styles/core/_responsive.css">
  <link rel="stylesheet" href="/src/frontend/styles/core/_navigation.css">

  <!-- ===== CSS COMPONENTS ===== -->
  <link rel="stylesheet" href="/src/frontend/styles/components/agent-buttons.css">
  <link rel="stylesheet" href="/src/frontend/styles/components/agent-selector.css">
  <link rel="stylesheet" href="/src/frontend/styles/components/buttons.css">
  <link rel="stylesheet" href="/src/frontend/styles/components/concept-recall.css">
  <link rel="stylesheet" href="/src/frontend/styles/components/concept-recall-history.css">
  <link rel="stylesheet" href="/src/frontend/styles/components/custom-select.css">
  <link rel="stylesheet" href="/src/frontend/styles/components/custom-toggle.css">
  <link rel="stylesheet" href="/src/frontend/styles/components/glassmorphism.css">
  <link rel="stylesheet" href="/src/frontend/styles/components/header-nav.css">
  <link rel="stylesheet" href="/src/frontend/styles/components/inputs.css">
  <link rel="stylesheet" href="/src/frontend/styles/components/modals.css">
  <link rel="stylesheet" href="/src/frontend/styles/components/tabs.css">

  <!-- ===== CSS FEATURES ===== -->
  <link rel="stylesheet" href="/src/frontend/features/home/home.css">
  <link rel="stylesheet" href="/src/frontend/features/chat/chat.css">
  <link rel="stylesheet" href="/src/frontend/features/debate/debate.css">
  <link rel="stylesheet" href="/src/frontend/features/documents/documents.css">
  <link rel="stylesheet" href="/src/frontend/features/cockpit/cockpit.css">
  <link rel="stylesheet" href="/src/frontend/features/threads/threads.css">
  <link rel="stylesheet" href="/src/frontend/features/memory/concept-search.css">
  <link rel="stylesheet" href="/src/frontend/features/memory/concept-management.css">
  <link rel="stylesheet" href="/src/frontend/features/voice/voice.css">

  <!-- ===== CSS SETTINGS MODULES ===== -->
  <link rel="stylesheet" href="/src/frontend/features/settings/settings-models.css">
  <link rel="stylesheet" href="/src/frontend/features/settings/settings-ui.css">
  <link rel="stylesheet" href="/src/frontend/features/settings/settings-security.css">
  <link rel="stylesheet" href="/src/frontend/features/settings/settings-main.css">

  <!-- ===== CSS DOCUMENTATION ===== -->
  <link rel="stylesheet" href="/src/frontend/features/documentation/documentation.css">

  <!-- ===== CSS SHARED COMPONENTS ===== -->
  <link rel="stylesheet" href="/src/frontend/shared/notifications.css">


  <!-- ===== STYLES UNIFIâ”œÃ«S ===== -->
  <link rel="stylesheet" href="/src/frontend/styles/main-styles.css">

  <!-- ===== OVERRIDES (hotfix UI) ===== -->
  <link rel="stylesheet" href="/src/frontend/styles/overrides/ui-hotfix-20250823.css">

  <!-- ===== DEBUG POINTER FIX ===== -->
  <link rel="stylesheet" href="/src/frontend/styles/debug-pointer-fix.css">

  <!-- ===== MOBILE MENU FIX (2025-10-06) - DOIT ÊTRE EN DERNIER ===== -->
  <link rel="stylesheet" href="/src/frontend/styles/overrides/mobile-menu-fix.css">

  <!-- CSS critique (loader + grille minimale) -->
  <script>
    // Apply theme IMMEDIATELY from localStorage to avoid flash
    (function() {
      try {
        const theme = localStorage.getItem('emergence.theme') || 'dark';
        if (theme === 'auto') {
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
        } else {
          document.documentElement.setAttribute('data-theme', theme);
        }
      } catch (_) {
        document.documentElement.setAttribute('data-theme', 'dark');
      }
    })();
  </script>
  <style>
    :root {
      --bg:#0b0f1a; --bg-2:#111827; --text:#e5e7eb; --muted:#9ca3af; --border:#1f2937; --sidebar-w:230px;
    }
    html, body { height: 100%; }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font-family: var(--font-sans, -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif);
    }
    body.loading { overflow: hidden; }

    #app-loader {
      position: fixed; inset: 0; display:flex; align-items:center; justify-content:center;
      flex-direction:column; gap:12px;
      background-color: var(--bg-2); color: var(--muted); z-index: 9999; opacity: 1; transition: opacity .35s ease-out;
      text-align:center;
    }
    #app-loader.fade-out { opacity: 0; }

    #app-loader img {
      max-height:64px;height:auto;width:auto;opacity:.9;margin-right:0;object-fit:contain;aspect-ratio:auto;
      filter:drop-shadow(0 0 22px rgba(56,189,248,.45));
      animation: emergenceLoaderPulse 8s cubic-bezier(0.22, 1, 0.36, 1) infinite;
    }

    #app-loader .loader-word{
      font-size:clamp(18px, 2.4vw, 26px);
      letter-spacing:.16em;
      text-transform:uppercase;
      background:linear-gradient(120deg, rgba(125,211,252,1) 0%, rgba(59,130,246,1) 45%, rgba(168,85,247,1) 100%);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      text-shadow:0 0 24px rgba(59,130,246,.35);
    }

    @supports not (-webkit-background-clip:text) {
      #app-loader .loader-word{ color:#e2e8f0; }
    }

    @keyframes emergenceLoaderPulse {
      0%,100%{ transform:translateY(0) scale(1); filter:drop-shadow(0 0 18px rgba(56,189,248,.38)); }
      45%{ transform:translateY(-6px) scale(1.04); filter:drop-shadow(0 0 24px rgba(168,85,247,.45)); }
      65%{ transform:translateY(-3px) scale(1.02); filter:drop-shadow(0 0 20px rgba(59,130,246,.5)); }
    }

    .app-container { height: 100vh; width: 100vw; }
    @supports (height: 100dvh) { .app-container { height: 100dvh; } }

    .app-sidebar, .app-content { min-height: 0; }
    .app-content{ overflow-y:auto; overflow-x:hidden; }

    #home-root { display:none; }
    body.home-active #home-root { display:flex; }
    body.home-active #app-container { display:none; }
  </style>
</head>
<body class="loading">
  <div id="app-loader">
    <img src="/assets/emergence_logo.png" alt="&Eacute;MERGENCE">
    <span class="loader-word">&Eacute;MERGENCE&hellip;</span>
  </div>

  <div id="home-root" class="home-root" hidden aria-hidden="true"></div>
  <div id="mobile-backdrop" class="mobile-backdrop" hidden></div>
  <div id="orientation-lock" class="orientation-lock" aria-live="polite" aria-hidden="true">
    <div class="orientation-lock__panel">
      <svg class="orientation-lock__icon" viewBox="0 0 24 24" role="img" aria-label="Rotation n&eacute;cessaire">
        <path fill="currentColor" d="M7 3a2 2 0 00-2 2v2h2V5h11v14H7v-2H5v2a2 2 0 002 2h11a2 2 0 002-2V5a2 2 0 00-2-2H7zm1.05 5.636l-1.414 1.414L8.586 12l-1.95 1.95 1.414 1.414L12 13.414l3.95 3.95 1.414-1.414L13.414 12l3.95-3.95-1.414-1.414L12 10.586 8.05 6.636z"/>
      </svg>
      <p class="orientation-lock__title">Mode portrait requis</p>
      <p class="orientation-lock__message">
        Veuillez pivoter votre appareil en mode portrait pour continuer &mdash; l'interface mobile est con&ccedil;ue pour ce format.
      </p>
    </div>
  </div>
  <div id="app-container" class="app-container">
    <header id="app-header" class="app-header" role="banner">
      <div class="header-logo-title">
        <img src="/assets/emergence_logo.png" alt="&Eacute;MERGENCE" class="header-logo">
        <span class="header-title">&Eacute;MERGENCE <span class="app-version" id="app-version-display" style="font-size: 0.65em; font-weight: 400; opacity: 0.6; letter-spacing: 0.05em;">beta-2.1.1</span></span>
      </div>
      <div class="header-actions">
        <button id="mobile-nav-toggle" class="mobile-nav-toggle" type="button" aria-expanded="false" aria-controls="app-header-nav">
          <span class="visually-hidden">Ouvrir le menu</span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <line x1="4" y1="6" x2="20" y2="6" />
            <line x1="4" y1="12" x2="20" y2="12" />
            <line x1="4" y1="18" x2="20" y2="18" />
          </svg>
        </button>
        <nav id="app-header-nav" class="mobile-nav header-mobile-nav" aria-label="Navigation principale" aria-hidden="true">
          <ul id="app-header-nav-list" class="mobile-nav-list"></ul>
        </nav>
      </div>
    </header>
    <aside id="app-sidebar" class="app-sidebar" role="complementary">
      <div class="brand-block">
        <img src="/assets/emergence_logo.png" alt="&Eacute;MERGENCE" class="brand-logo">
      </div>
        <nav id="app-tabs" class="sidebar-nav" aria-label="Sections"></nav>
        <div id="sidebar-auth-status" class="sidebar-auth-status" role="status" aria-live="polite"></div>
        <div class="sidebar-auth-actions" data-auth-host></div>
      <div id="settings-container">
        <div id="memory-overlay" class="memory-overlay" aria-hidden="true">
          <div class="memory-overlay__backdrop" data-memory-close></div>
          <section class="memory-overlay__panel" role="dialog" aria-modal="true" aria-labelledby="memory-overlay-title">
            <header class="memory-overlay__header">
              <div class="memory-overlay__title">
                <svg class="memory-overlay__icon" viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" focusable="false">
                  <path d="M9 3a4 4 0 00-4 4v1.5A3.5 3.5 0 003 12a3.5 3.5 0 002.1 3.2A3.8 3.8 0 007 18.5V21h3V3H9zm6 0a4 4 0 014 4v1.5A3.5 3.5 0 0121 12a3.5 3.5 0 01-2.1 3.2A3.8 3.8 0 0117 18.5V21h-3V3h1z" fill="currentColor" />
                </svg>
                <h2 id="memory-overlay-title">MÃ©moire</h2>
              </div>
              <button type="button" id="memory-overlay-close" class="memory-overlay__close" data-memory-close aria-label="Fermer la fenÃªtre mÃ©moire">
                <span aria-hidden="true">Ã—</span>
              </button>
            </header>
            <div id="memory-panel-host" class="memory-overlay__body"></div>
          </section>
        </div>
      </div>
    </aside>

    <main id="app-content" class="app-content" role="main">
      <!-- squelette lâ”œÂ®ger le temps du boot JS -->
      <div class="skeleton" style="height: calc(100vh - 56px); border: 1px solid var(--border); border-radius: 10px;"></div>
      <div class="skeleton" style="margin-top:10px; height: 44px; border-radius: 10px;"></div>
    </main>
  </div>

  <script>
    (function () {
      performance.mark('html:begin');
      var nav = performance.getEntriesByType && performance.getEntriesByType('navigation')[0];
      window.__EMERGENCE_BOOT__ = { ttfb_ms: nav ? Math.round(nav.responseStart) : undefined };
      document.addEventListener('DOMContentLoaded', function () {
        performance.mark('html:domcontentloaded');
        requestAnimationFrame(function () {
          var loader = document.getElementById('app-loader');
          if (loader) { loader.classList.add('fade-out'); setTimeout(function(){ loader.remove(); }, 250); }
          document.body.classList.remove('loading');
          var paints = performance.getEntriesByType ? performance.getEntriesByType('paint') : [];
          var fcp = (paints || []).find(function(p){ return p.name === 'first-contentful-paint'; });
          if (fcp) window.__EMERGENCE_BOOT__.fcp_ms = Math.round(fcp.startTime);
          console.log('[BOOT][front]', window.__EMERGENCE_BOOT__);
        });
      });
    })();
  </script>
  <script>
    (function () {
      function resolveMaxWidth() {
        try {
          var raw = getComputedStyle(document.documentElement).getPropertyValue('--orientation-lock-max-width');
          var parsed = parseInt(raw, 10);
          return Number.isFinite(parsed) && parsed > 0 ? parsed : 960;
        } catch (_) {
          return 960;
        }
      }

      var lockNode = document.getElementById('orientation-lock');
      var threshold = resolveMaxWidth();

      function shouldLock() {
        if (!lockNode) return false;
        var width = window.innerWidth || document.documentElement.clientWidth || 0;
        if (width > threshold) return false;
        return window.matchMedia('(orientation: landscape)').matches;
      }

      function refreshOrientationLock() {
        var blocked = shouldLock();
        if (blocked) {
          document.body.classList.add('orientation-locked');
          lockNode.setAttribute('aria-hidden', 'false');
        } else {
          document.body.classList.remove('orientation-locked');
          lockNode.setAttribute('aria-hidden', 'true');
        }
      }

      window.addEventListener('orientationchange', refreshOrientationLock);
      window.addEventListener('resize', refreshOrientationLock, { passive: true });
      document.addEventListener('DOMContentLoaded', refreshOrientationLock);
      if (document.readyState !== 'loading') {
        refreshOrientationLock();
      }
    })();
  </script>

  <script type="module" src="/src/frontend/main.js" defer></script>
</body>
</html>

