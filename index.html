<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Émergence V8</title>

  <!-- Favicon (on reste sur .ico present dans l'arbo) -->
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />

  <!-- Preload du module principal -->
  <link rel="modulepreload" href="/src/frontend/main.js" />

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- ⚠️ Remplace par TON Client ID Web OAuth Google (exact) -->
  <script>
    window.EMERGENCE_GOOGLE_CLIENT_ID = "486095406755-mbjgt9np24o4jg15jrgko74dennlqhp7.apps.googleusercontent.com";
  </script>

  <style>
    :root{
      --bg:#0b0f1a;--bg-2:#111827;--text:#e5e7eb;--muted:#9ca3af;--border:#1f2937;
      --sidebar-w:260px;--header-h:56px;
      --safe-top:env(safe-area-inset-top,0px);
      --safe-bottom:env(safe-area-inset-bottom,0px);
      --font-sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
    }
    html,body{min-height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: var(--font-sans);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    body.loading{overflow:hidden}

    /* Loader */
    #app-loader{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background-color:var(--bg-2);z-index:9999;opacity:1;transition:opacity .5s ease-out;}
    #app-loader.fade-out{opacity:0}
    #app-loader img{width:128px;height:128px;animation:pulse 1.6s infinite ease-in-out;}
    @keyframes pulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.08);opacity:.85}}

    /* Layout */
    .app-container{
      display:grid;
      grid-template-rows: calc(var(--header-h) + var(--safe-top)) auto;
      grid-template-columns: 1fr;
      grid-template-areas: "header" "main";
      min-height:100dvh; width:100vw;
    }
    .app-header{
      grid-area:header; display:flex; align-items:center; padding:0 16px;
      padding-top:var(--safe-top); border-bottom:1px solid var(--border);
      position:sticky; top:0; z-index:10; backdrop-filter:saturate(1.2) blur(10px);
      background:rgba(0,0,0,.35);
    }
    /* ✅ Titre +2 niveaux (de 20px → 24px) + logo ×1.5 */
    .header-title{font-size:24px;margin:0;display:flex;align-items:center;gap:8px}
    .header-title img{width:36px;height:36px}
    .header-nav{display:flex;align-items:center;gap:.5rem;margin-left:auto}

    .app-sidebar{display:none}
    .app-content{grid-area:main; padding:12px; padding-bottom:calc(12px + var(--safe-bottom)); overflow:visible;}

    /* Sidebar branding (desktop) */
    .sidebar-brand{
      display:flex; align-items:center; gap:10px; padding:8px 4px 16px;
      border-bottom:1px solid var(--border); margin-bottom:12px;
    }
    .sidebar-brand .sidebar-logo{width:48px;height:48px}
    .brand-title{font-size:22px; font-weight:800; letter-spacing:.08em}

    .skeleton{background:linear-gradient(90deg,rgba(255,255,255,.06),rgba(255,255,255,.12),rgba(255,255,255,.06)); background-size:200% 100%; animation:shimmer 1.1s infinite; border-radius:8px;}
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
    .chat-skel{height:calc(100dvh - var(--header-h) - 56px); border:1px solid var(--border)}
    .input-skel{margin-top:10px;height:44px}

    @media (min-width:768px){
      .app-container{
        grid-template-rows:auto;
        grid-template-columns: var(--sidebar-w) 1fr;
        grid-template-areas: "aside main";
      }
      .app-header{display:none}
      .app-sidebar{display:block; grid-area:aside; border-right:1px solid var(--border); padding:8px;}
      .app-content{grid-area:main; padding:24px; overflow:visible}
    }

    /* ✅ Forcer le mode "header" sur mobile paysage faible hauteur (collapse sidebar) */
    @media (orientation: landscape) and (max-height: 500px){
      .app-container{
        grid-template-rows: calc(var(--header-h) + var(--safe-top)) auto;
        grid-template-columns: 1fr;
        grid-template-areas: "header" "main";
      }
      .app-header{display:flex}
      .app-sidebar{display:none}
      .app-content{padding:12px; overflow:visible}
    }

    /* ✅ Paysage “compact” avec sidebar visible : largeur/espacements réduits */
    @media (orientation: landscape) and (min-width:768px) and (max-height:700px){
      :root{ --sidebar-w:210px; }
      .app-sidebar{ padding:6px; }
      .sidebar-brand{ padding:6px 4px 10px; margin-bottom:8px; }
      .sidebar-brand .sidebar-logo{ width:40px; height:40px; }
      .brand-title{ font-size:20px; }
      .app-content{ padding:12px; }
    }
  </style>
</head>
<body class="loading">
  <div id="app-loader">
    <img src="assets/emergence_logo.png" alt="Emergence Logo" />
  </div>

  <div id="app-container" class="app-container">
    <header id="app-header" class="app-header" role="banner">
      <h1 class="header-title">
        <img src="assets/emergence_logo.png" alt="Logo" />
        Émergence
      </h1>
      <nav id="app-header-nav" class="header-nav" aria-label="Navigation principale"></nav>
    </header>

    <aside id="app-sidebar" class="app-sidebar" role="complementary">
      <div class="sidebar-brand">
        <img src="assets/emergence_logo.png" alt="Logo ÉMERGENCE" class="sidebar-logo" width="48" height="48" />
        <div class="brand-title">ÉMERGENCE</div>
      </div>
      <nav id="app-tabs" class="sidebar-nav" aria-label="Sections"></nav>
      <div id="settings-container"></div>
    </aside>

    <main id="app-content" class="app-content" role="main">
      <div class="skeleton chat-skel"></div>
      <div class="skeleton input-skel"></div>
    </main>
  </div>

  <script type="module" src="/src/frontend/main.js" defer></script>
</body>
</html>
