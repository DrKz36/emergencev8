═══════════════════════════════════════════════════════════════════════════
🚀 CODEX CLOUD - ACCÈS GMAIL GUARDIAN (4 MINUTES)
═══════════════════════════════════════════════════════════════════════════

📋 RÉSUMÉ ULTRA-RAPIDE

Codex Cloud peut lire les emails Guardian via l'API Cloud Run.
Tout est déjà configuré côté backend ! Il te reste 3 étapes de 2 minutes.

───────────────────────────────────────────────────────────────────────────
✅ ÉTAPE 1: AUTORISER GMAIL OAUTH (TOI - 2 MIN)
───────────────────────────────────────────────────────────────────────────

Action:
1. Ouvre ce lien (connecté avec gonzalefernando@gmail.com):

   https://emergence-app-486095406755.europe-west1.run.app/auth/gmail

2. Clique "Autoriser" sur Google consent screen
3. ✅ Tokens OAuth stockés automatiquement dans Firestore

Fréquence: UNE SEULE FOIS (tokens persistent)

───────────────────────────────────────────────────────────────────────────
✅ ÉTAPE 2: CONFIGURER CODEX CLOUD (TOI - 1 MIN)
───────────────────────────────────────────────────────────────────────────

Donne ces 2 credentials à Codex Cloud (dans .env ou variables d'env):

EMERGENCE_API_URL=https://emergence-app-486095406755.europe-west1.run.app/api/gmail/read-reports
EMERGENCE_CODEX_API_KEY=77bc68b9d3c0a2ebed19c0cdf73281b44d9b6736c21eae367766f4184d9951cb

⚠️ IMPORTANT: Ces secrets doivent être sécurisés (jamais en dur dans code)

───────────────────────────────────────────────────────────────────────────
✅ ÉTAPE 3: TEST D'ACCÈS DEPUIS CODEX (CODEX - 1 MIN)
───────────────────────────────────────────────────────────────────────────

Test curl:

curl -X GET \
  "https://emergence-app-486095406755.europe-west1.run.app/api/gmail/read-reports?max_results=5" \
  -H "X-Codex-API-Key: 77bc68b9d3c0a2ebed19c0cdf73281b44d9b6736c21eae367766f4184d9951cb"

Résultat attendu: 200 OK avec liste d'emails Guardian

───────────────────────────────────────────────────────────────────────────
📝 CODE PYTHON POUR CODEX CLOUD
───────────────────────────────────────────────────────────────────────────

import requests
import os

API_URL = os.getenv("EMERGENCE_API_URL")
CODEX_API_KEY = os.getenv("EMERGENCE_CODEX_API_KEY")

def fetch_guardian_emails(max_results=10):
    response = requests.get(
        API_URL,
        headers={"X-Codex-API-Key": CODEX_API_KEY},
        params={"max_results": max_results},
        timeout=30
    )
    response.raise_for_status()
    data = response.json()
    return data['emails']

# Test
emails = fetch_guardian_emails(max_results=5)
for email in emails:
    print(f"  - {email['subject']} ({email['date']})")

───────────────────────────────────────────────────────────────────────────
🐛 TROUBLESHOOTING
───────────────────────────────────────────────────────────────────────────

401 Unauthorized → Vérifier API key dans header
403 Forbidden → Refaire OAuth flow (Étape 1)
500 Internal → Checker logs Cloud Run
Pas d'emails → Vérifier que Guardian envoie bien des emails

───────────────────────────────────────────────────────────────────────────
📚 DOCUMENTATION COMPLÈTE
───────────────────────────────────────────────────────────────────────────

Guide détaillé: CODEX_CLOUD_GMAIL_SETUP.md

═══════════════════════════════════════════════════════════════════════════
TOTAL: 4 MINUTES POUR BRANCHER CODEX CLOUD AUX EMAILS GUARDIAN ! 🚀
═══════════════════════════════════════════════════════════════════════════
