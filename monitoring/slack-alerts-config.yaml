# Configuration des alertes Slack pour Emergence
# √Ä utiliser avec Prometheus Alertmanager ou directement dans le code

slack_webhook_url: "${SLACK_WEBHOOK_URL}"  # √Ä d√©finir dans .env
channel: "#emergence-alerts"
username: "Emergence Monitoring"
icon_emoji: ":robot_face:"

# Alertes critiques (notification imm√©diate)
critical_alerts:
  - name: "HighErrorRate"
    condition: "error_rate > 5%"
    message: |
      üî• **CRITICAL: Taux d'erreur √©lev√©**
      - Taux d'erreur: {{value}}%
      - Seuil: 5%
      - Actions: V√©rifier logs, rollback si n√©cessaire

  - name: "AITimeout"
    condition: "ai_timeout_total > 0"
    message: |
      ‚è±Ô∏è **CRITICAL: Timeout AI d√©tect√©**
      - Provider: {{provider}}
      - Model: {{model}}
      - Dur√©e: {{duration}}s
      - Actions: V√©rifier connexion API, augmenter timeout si n√©cessaire

  - name: "SQLInjectionAttempt"
    condition: "sql_injection_attempts_total > 0"
    message: |
      üö® **SECURITY ALERT: Tentative d'injection SQL**
      - IP: {{source_ip}}
      - Endpoint: {{endpoint}}
      - Payload: {{payload}}
      - Actions: Bloquer IP, analyser pattern

  - name: "BruteForceLogin"
    condition: "failed_login_attempts > 5 in 5min"
    message: |
      üîí **SECURITY ALERT: Brute force d√©tect√©**
      - Email: {{email}}
      - IP: {{source_ip}}
      - Tentatives: {{attempts}}
      - Actions: Bloquer IP, activer 2FA

# Alertes warning (notification group√©e)
warning_alerts:
  - name: "SlowResponse"
    condition: "p95_latency > 2s"
    message: |
      ‚ö†Ô∏è **WARNING: Latence √©lev√©e**
      - P95 latency: {{value}}s
      - Endpoint: {{endpoint}}
      - Actions: Investiguer performance

  - name: "RateLimitExceeded"
    condition: "rate_limit_exceeded > 100 in 1min"
    message: |
      ‚ö†Ô∏è **WARNING: Rate limit fr√©quemment d√©pass√©**
      - IP: {{source_ip}}
      - Nombre: {{count}}
      - Actions: V√©rifier si abuse ou augmenter limite

  - name: "SlowQuery"
    condition: "query_duration > 1s"
    message: |
      ‚ö†Ô∏è **WARNING: Requ√™te DB lente**
      - Dur√©e: {{duration}}s
      - Query: {{query}}
      - Actions: Optimiser query ou ajouter index

# Alertes info (notification quotidienne)
info_alerts:
  - name: "DailyStats"
    condition: "cron: 0 9 * * *"  # Tous les jours √† 9h
    message: |
      üìä **Rapport quotidien Emergence**
      - Requ√™tes totales: {{total_requests}}
      - Utilisateurs actifs: {{active_users}}
      - Taux d'erreur: {{error_rate}}%
      - Temps de r√©ponse moyen: {{avg_response_time}}s
      - Top 3 endpoints: {{top_endpoints}}

# Configuration de groupement
grouping:
  interval: "5m"  # Grouper alertes sur 5min
  max_alerts: 10  # Maximum 10 alertes par notification

# Configuration de r√©cup√©ration
recovery:
  send_resolved: true
  message: |
    ‚úÖ **RESOLVED: {{alert_name}}**
    - Dur√©e: {{duration}}
    - R√©solu √†: {{resolved_at}}
